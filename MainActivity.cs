/* A̬̤̣̹̱̜̟ͭ̉̋͊̑͊͑p͒ͪͩͨpͣ̽̊̃ ̻̉b̬̫͓̬͇̆̀ͩ̀́y̩͈͕͕̱̗͕ͮͫ̑ͩ̉̐̚:͖̱̥͖̤̫́̌̆͋̂̚
 
/̭̝̣̱̳̩̰̥̫̟͎͙̬*̩̤̮̥̖͇̩͙̩̝̦͍͋͒ͣ͑̃ͧ̋̊ͨͫ̅ͬͪ̚ͅͅ ̘͎͎̲̟̬̙͖͚͍͉̹̺͈͋͂̓̾̾ͨ̑ͤ̓ͧ͊̽ͤ͋ͩͅA̲͙͙̦ͮ͌ͥ̍p̝̭͙̣͙̈́ͥ͊͒̒p͖͙̖̝̘͎͙͖̣̟̙̝̺ by̩̱̖̙̲̹̘̱̱̲̼͗̒͒ͦ͒͗͋̒̃̓̔̍ͅ:̣͔͓͊ͫ͑
 ͕͎̖̺͉
 /͇̲̞̬̘ͅ*̝̦̥̹͚̔ͦͥ̑ͨ ̽̐͐̿A̼͔̬̠̮̟̭̾͐̑̂ͮ͂̚pp̫͚͕̳ ̪̻̹̓͒͆by:̤
 ̹̪̋̇

.̤͙̜̥̖̲͗ͤ̎̂ͣͬ_̯̗̠̯̰͑̒̈͆ͩ_͎̬͈̱͉̼͈ͤ̎ͥ̏̊ͪ̓ ̬͉͍̗ ͚ ͙̫͈̪̠̗ ͥ͂̍͐͛̈́ ̂ͭ ͚̰͈̬̜̭͈ͨͫ̈́̇̐̑̂ ͇͇̋̌ ̪̲ ͐ͩ͗̽ͦ ͗̌̓͐ͬ ̊  ̳̝̰ ̠͓̜̠̠͉ͣ͋ͪ̽̆́ ͒̇ͭ̉ ̦̣̫̝͚͈̫̉̂̿́͒̂̉   ̀̈́̅̎ͩ̍ ̩̹̘́̎̏  ̺̙̺͇̆̿́͋ ̜̬̭̰̉̇́̎ ͈̮ ͖̹͓̺ͣ͑ͨͥ͛ͅ ͮ̍  ̹͚ ̀̃̏ͮ̃̈́ ̼̰͕̱ ̬͒  ͖̞͖͋ͬ͂ ̯̦ͬ̾ ͐̓͊ͮ̚ ̽ͦ͒̋̋ ͖͇̈́ͩ ͭ̐͂͆̋́̾    ̺ͦ ̦̱̯͖ͥ͒͐̒ ̼͉͇̠̒̓ͮ̌ ̤̣̩̙̺ͤ͑ͮ͗ͬ.̥̟̦͖̙̠̺͊̓̏̈́͌̈́́_̤͓̱̱̜̫_͕̮̪̝ͅ_͉͙͈̠̣̻̫ͮ̅̓̀ͤ͑̓
|̼͇̠͓̙͂̏͌ͬ́ ͉̟̭̬̝̎̒́ͥ̚ ͓̼͓̙̟ͤͫ̋̈ͯ|̦̺̞̺͍̄̃̀̓ͧ_̖̰̝̬̘̲_̫̯̫͇̲̗ ̺͕̫͔̍ͧ͒̿ ̲͉̟̰̤̈́ͯͭͯ͋ ̮̯̰͚̭_̼̠͇_͗ͩ̄͛͋̉̚__ ͚̘̈́̓_ͣ̒ͨ̑̚̚_̠̼ͯ̉_  ͙͚̙̱̩͕_̆_͈̯̗̻̙̳͋ͧ̄̿͑͂_͙̠͕_͈̲͒͑_̞̹͋ͫ_̱̞ͬ͊_̻̹̪͚̘̦͋̋̍͊̍ͬ_͗͑̀ͭͯ̑  ͫ̎ ͙͉͚ ̍̄ͫͪ __̱͓̳̬̮ͅ_͉̬̦͉̩̥͈_̯̈ ̋̈̋̇̚  ̱̫ͤ̅_̜̒_̬̯̪̫̓̅ͥͭ_̬͙̟̠̭̋̓͒ͩ͑_͔̏  ̪͕̖̊̍̅̚ͅ ͔͖̼̯̃ͩͫ̓_̻̙̼̟_͔͙͉̗̦͉ͧͯͦ͌̈́̃|̭̞̞̹̙͒̈̑̋ͣ ͈͕̳̟̬̗͚̀ͫ̎ͣͫ͛ͫ_̯̬̠͇ͮ̀ͬ̚/͍̞̦͓̖̘̞̍̒̾̽ͧ̏̅
|̓͑̆̂ͪ̐̚ ͓̱̱̲̤͇͎̃̑ͣ̾͑ͤ̊ ̹̦̪͒̋͗|̗͙ͬ͌ ͔́ ̼͔͇̮̌̔̈́̓\̾̌ͪͥ̏̚_̹̲̦͎͇͈̜͑̅͑ͫ̇͋̃/̇ͩ __ \̦͔͈͇ͣ̆͌̃͐ͅ\̫͑ ͩ̇ ̗̹\͙͑/ͧ̒̍̚ ̲̤ͯ̐ /̬̳̮̣\̻͕̬̗͖̙̣̋͒̔ͯ͗͑̑_̮͑_͑̈́ ͫͩ͌ ̱̬̒̽\̀ͬͫ̍̆̔ ̓͐͑ ̀͂͗ͪ̽͌ͩ ̜͎̥̱͙ͧ͆͐̔̅/ ͑̎ͫͯ́̿_̎ͤ̐ͣͤ̾__ͥ̉͊ͥͭ\̫̠͉ͤͨ͗ ̯͉͉͍̟͈̙ͧͫ̂ͦ͐̌͛/̳̜̺̤̼̯̝  ̰̪̖͑͒͋_̲̥͈̣ͧ͒͛̌ ̗̩̞̭̖̝ͅ\̣̝̪̒̓̀̓̇ͅͅ ̣̯͎̠͈͔/͊͂ _̣͉̥̺͗̒̏̐_̾ ̹̙̹̳̈̊ͣ̚|͙͉̹̮̾ͭ͊ͫ ͍̪̻̍͆ͭ
  |̪͈͙ͪͧͬ ̞͓̟̭̻̖̙̅ͨ́ͧ̐͌͒  ̙̠̰̗̥ͣ̂͋ͩ̚Y ͈͍͙͈̺́ͪ̔͑̽ ͧ̔̋ͭͦ̓\  ̮̝̈́̋_̪̯̫̱̳͈_̙͎͙̳͕̺̩̓̓̅͋̃͐ͨ_̳̗̰̘̮̑ͥͧͤ̔/̫̮̙̳̭̭ ̟̖̄͒>̗͇̱̯̫̱ ̠̭̩̘̐̄͗̒ ̲͈͈̀ͥ̋ ̱̻͕͓̮͉͈ͭ̂̈́͛̿ͥͥ ̹̮͕͉͎̝ͬ͊̆̀̈̋͆ͅ<̬̠ͩ͋ ̮̩͙̊ͤ̒ ͦͣ͗̉/ ̞͈̣̤̰͙̟ͩ͒̓͒ͭ̔̚_͗͒͐_̳̘͑̎ ͙̮̤̜̱͙̐̊̐ͨ̋͆\_͍̖̮̜ͩ̽͗̃/ ̙̙̐ͯ/̯̳̠̬̻̯͖_͔̭̫͛͆̋/̘̌ ͇͇̫ ͤ͑̚> ͈̞̼̫̩ ̗͍̞̣̼͔͒͊̒̐̓ͮ<͖̠̪̥͔_̗̪͎̆̆͆> ̳̱̺̟ͨ̄ͣ̚)͉̘̯̋ͧ̈ ͐̌ͮ͗/̮̙͇̾ͪ͐_̣̖͕ͦ̔̀/̱̬̦̻ ͎̟̞̫͔ͦ̒͛̉ͣ|͔̹̲̬͖̬̰̀̏ͣ͐ͫͨ̓ ̬ͥ
 |_̗̰̇̄__̭ͅ|͈ ̼̣ /̳͙̓̊\̣͔̗̱̳_̤͕̻̣͎͓̀̾̆̉ͤ̚_̌_͙̺̗̅̋̿ ̎ͫ̃ ͔̜ͨ̈́>̟̲̫̣͎̝ͯ̀ͭ̾͂͊_̲̱̳_̯̬̙͍ͫ̾̍̎/̖ͭ͑ͅ\͕̱͈̣̟͎̞ͤ̈͐́͌̆̿_͕̩̫̓̔̎ \̤͙͚͇̙͆ͧ̆ͫ̆(͉͖ͭ̒_̤̹̖̖̞̖__͎̹̖̻͋͒ͦ̆_̝̰̖͔͆͛ͦ̀ ̥̻̐̽ ̪̣͙̖/\ͭ͛͂̽̂̋̊_̮͕̥̤̤̈́̽ͫ̓͊_͈̭͔̞͚̔ͥ̀͒̚_͎̜ ̟̭͔̣͋́̈́̿ ̹̰̺͍̙͈̩̔̔̀ͦ͑͛̽/͍̪̲̰̻͚ͅ \͍̺͎̭̞͓̹̒ͩ̔͂̄́̐_̮̻̳_̼̺̄͑_̱̮͍́͌̓_̗̗ͅ/̌̌̇͆\_͉͚͎̺͙̅ͦͤͧ͗_̆ͨ__̼̹̪̱̳̳͔̉̆ͨͦͯ̒͊ |͍̺ͤ̅ ̌ͨ̇
 ̲̺̘̖ͪ̊͐̄ ͔̇ ̭̞͕͓̭̣͎̌̓̿̇̃̅̚ ̮͙̲͓͖̲ͣ̋̏̂͗̒ \̙͚̳̗̝̭́̆͐͗̅ͣ̽ͅ/ͨͣ̅̓̑  ̜͕͈̺̩̺̓ͮ̈́̂ͫ͆ ̤̼̰̖̪̠ ̘̥̩̰̣̗̮͑͒ͩ͗̃͌ͥ ̣͖̐͗\̹̬̖̹̪͕̍̏̈́͊̈ͥ̚ͅ/̝͓͙̜̜͉̿ͭ̉ͩ̽̔ͪͅ ͣ͒̇̽ ̩̳͙̥ͯͧ͗ͪ  ̹̤̗̝͇̄̅͑̿̃  \̰͉ͬ̽/̩̩̻̮ͭ̀̍̒ ͚̼͓̟͍̳ ̭̞  ̞̝̞͉̠̰̾͑̓̎ͦ̂ ̮͇͈͎̫̦̖͌̑͗ͣ̉ͬ̆\//̮̥̤̱̥͚̼̍͗̍̋͑͒ͨ_̺̰̳̲̥̼̀̇͛ͮ̒̑_̼̥̫̼͈ͨ̊̍̀͆̓ͅ__̿ͭ̔_̝/  ̼̗ ͙͓̖͉̯̬̯͋̾͌̍̍͑͐ ͕̺̺̖̖ͬͤ̓̄̀ ̱̻̝̮̩̩ͅ ̭̟̒̎ ̬́ ̪̩̮͓͖̬̣͂̋̐̑̐̽̒ ̖ ̲͉̗̪̗̐ͨͫ̿̇ ̜͔̘̜̫͓̝ ̱̦͓̥͖̼ͧͫ̋̂̓ͫ ̲͕̟͍̱̳ͨͥ̍͌͗ͨ\/ ͍͎̰͙ͩ̓̊͑

 b͔͐it̻͔̖̹̭͚͒̓͒̾ͤͩc̘̝͚hut͉͍̮͉̲̃̑̆̑̒e͈̥̠ͅ.̬͖͈͙͎̝̀̇̆ͣ̍̓có̓̏̓ͫm͙͈͚̟̫̝̗ͦ͛̾ͤͤ̅̋/̳̀c͉͎͕̓̂̇ha̞̲̼͕͍͔̫̓̐͋͌̍ͫ͗n͕̦̯ͦ̂ͧne̹͙̙̟̼̼ͯͣͪ̈́́̿l͗ͣ̓̓ͧ͆/͙̬͚̯̍ͩ͌̒h̬̟̼̥e̥̹x̖̖̜̎͂͋a̹̟̟̝̞̰̳̎ͩ͋ͫ̑ͫ̈́g͕̞̻͈ͩ̍ͤͦo͚̮̰̟͓̬̱ͫͦ̾̆ͫ͛̑d͇̐
sͬ͌ou͈͕͉n͔̣̗͉ͨ͛ͫ̽dc͍̞̰̮l̻̙͇̼͔̦o̪̮u͙̤̹d̟̙͈̗̫̮̥͌̐͐ͬ̈́͑̇.̘̓c̪̹̞͙̯̮̈̌͒͋̓̓om͋̑̉̚/̇̏ͬ̑̈̈͐v̼ẙ̞̦̳̩̥ͤ͌̅͒b̯̟͚̰̎̃̃ͣe͈͔͓ͩͨͦͪͅm̲̯̤̥a̟̫͖̾̂́s̥̞̲͚̬͚̎ͣ̀̎̋̚t̮̺̹ͩ̓̽e̺͓ͣ͆r͐̒̑̿̂̍̚z̏̑̉ͥ̔

tͫ̿w̪͓͓̥ͥ͑̌̾i͈̯̲̦̠͕̿́̇ͬ̀͂t͎͓̟̥̝͍t͉̭̯̓͐̃e͉͈̖̰͇̠̓̂̓̈́̃̏r ̹͇̟̦̜̉ͪͭ̅̾@̳̘̙̗̈ͪ̾̒v̈̊̈́y̠̦̿͑bͪͧ͐̌ͩͥể̪͖̞̤̯̼̪̇͐̔̒͂yp̩͔͈̥͓̤̭̃ͧͯ͆ͭ̈́͌an͖̼̙̤̰̰ͨ͊͒ͤ̊̓ͩͅt͍̲ê͎̪̄l̝ͤo̟̰̻̼n͍̖̍ͨe͕̫͆͛z̲̮̓̿
m͋ͩͪ͂̃i͕̜̭̜nͮ͒ͫͧ͑ͭͨd̦͚̣̒̉̓̓ͅs̹̫̜͍̄́̈̋ ̲̰͛̍@̜̗̬͍̲̅͗͗͋ͨh͇̹̠͔͖̹̹ͧͪ͑͂ͤͨͬeͧ̿ͣ͊x̥̘͇͖̯̝͊̆̀̔ͥ̈́ag̲͇̬ͯ͐̐o͔͚̞̽̎̾d̼̝
s͗ͪ̅͌̚t͍ěͧ̈e͐̃̈́̃ͪͬ̐m͇͈̙̏̑̑i̙͓̰̾̊̚ṭ̩̬̼̬̠̅ͨ͐ͪ̂ͣ ͖̗̅͑@ͫ̊v͍̊ỳ̆b̼̟͉̙̲̜e̬̩̰̪̮̗͗̓̍̋́͗̿ͅṁ͊a̋͌̎ͮs̘̺̲t͎̤̖e͍̜͆̽r̠͖̙̹͍̯̀͊ͬ͒ͬ͆z
g͇̻̤͉̤̞͌̏ͨ̎̆͆a̅̀̊ͦb͔͇̱̰͙ͅ.̠͔̯a̠̜͉̦͊͑̊̿i ̳̳̞̥͈̙̽͋ͦͮ̇͊@̞͍̜͉̼̠̈́̇̐̂̄ͭh͓͓̠̙̪͌ͦ͗̓͌e̟̼̞̱̘̲ͯͦ̔̇̇ͮ̀ͅx̦̻̭̥̉̾̌ͭa͚̙͚̼͙͍g͕̣̣̣̻̀̀̆̔ͥoͥ̓̒͌͐̎̉d

b̟̠̼͕̞̙̈́ͮ̒̀͆̈́a̅̑ṣ̗͇͇̱̄̇ͭ̇̊e̅͂͗̀d̥͉̳͈̻ ̟͔͋͌ö́̀̓͆̈͛ff̻̜͍̼͖̦̔̎̿ͯ͆̆ ̎͗̅th̘̤ͧ͒e̱͐͌ͅ ͈̜̼͕ͅtͨ͒͂emplͫ̆ǎt͗ͣe̗̣̮̠ ̼͈̰̬̩̙̽͐̾ͯͯ͂b͔̫͇̱͔̹̼̃̃̂̊ͥͨͣy ̜̼͓̮̯̤̝h̎n̿̍̓̊̂ā̭̞̥͔̦̭͗ͩ̈̿͛b̞ͅb̹̮ͭ̈ǎ̘s̝̒̑ͅi̩͙̤̘ͅ
h̠͕̖̟̱t̫tͦͪ͛ͬͬ̿͑p̤̺̯͕̠̺͉̀͆̓̄̃ͦ̔s̜͈̥̖͙͒͗ͥ̆ͧ://̆g̐̑̿ͯͫ̇͌i̱̪̖̹̹̼̱͊̒͒̓̆̈́̆tͬh́̆ͥ͒ub.̣̻̭̯̟͉c͚̦̞̣͌͊ͣ̚o̖̩̦̗̬m̃̌̄̚/͈͕͛́h̹̝̥͍̰ͪ̃̒ͮͨna͎̦̻͍̰̦͇b̻̗̂͌bà̖̭ͣș̏i͓͙̤͖̘̰̣/ͅB̠̥̰͚͓̬̫ͪ̂ͦ͐͌ͩ̚ȍ̝͓͍̙̔͐͌tt̼̪̜̬̬͓om̳̜̖̜̙͆̾̒̏ͨN͓͇aṽ̪̙̰̇̌iͩ̎ͧ̄̆ͪg̬̭̠aẗͩ͋ͭͩio͔̲̯̾ͤ͆n̋̿̓ͭ͌̐Vͦiͮ̑̒͒̇͛eẁ̟̻̪̠̣̄̈̿̐P͕̜͍͕̩ag̺͈̩̹̘̹ͦ͑̓ͫ͗̀er
 ̮̱ͅ
 ͎̈́*̞̹͇ͅ/



 bitchute.com/channel/hexagod
soundcloud.com/vybemasterz
soundcloud.com/hexagod

t̻͙͗̓wi͍̼̩̣͛͋ͨ͂tt͊e̫̳͍ͭͯ̐r̠̯ͦ̋ @vybeypantelonez
mi̘̠̦͔͓͒̓̊͑̂n̈́̔͋ͨ̔ͫ̓d͖̤͆ͨs̙͉̰̼ͣ̐̅̎ ̩͔̤͛͆̓@̦̬̪̰h͇̦̗͚ͅe̞̲͕̳̘̰̿̎ͦ̈́̊ͭ̆ͅx̦̼͓̳̰͍ȁ͍̣̙͓̝͂͋͗́g̫̫̦͉̠̃̍̃̆ͫó͖̭͔̦͉̬̇̽̍ͤͬd̎̄ͦ͗
s̪͌t̖͑e̯̻͐ͧe̱̅m̙̼̩̤͎̬̞i͓̦͔t͖̺̙̗͍̞ ̪͎͕̲̱ͨ̎͗̒̚@vybemasterz
g̪ͧab.̖͔͍͖̟ͤ͒͗͆̽ai̹͇̭͙̲̘ͨ͒̅ͥ̂̀ @̜̙͖͕͙̓ͯͪ̌ͩh̏ͭ̿̾e̫̼͓̠̜̭x͚̼̭̩̔͑̅ͦạ͉͓̥͋ͭ̅̒g̹̑o̗͑͌ͅd̠͙͕̤̩ͩ̾͌̽̄

b̏͒a̺̲̺s̲ḛͩd ̲͓̘͇̆̊ͨ̂ȍ̭̙̣̝̈́ͣ̅f̫̩̀̚f͔̹̯̞͓ͮ͋̔̆̃ͮͅ ̥̟ͥ̿t͍̰̗̠ͪ̍̿̓h̘͔͎̲ͅe͎ ̌̄ẗ̩͉̣̬̳̜́͆ͪͣ̄̂e͕̝̭̗̘̘̺̎͗̌ͬ̈́ͤ̒m̬͚ͦ͊ṗ̞̪͍̝̙̞̩͐̃͗̉̅̋l̼̤̲͐̓ͭåͤ̿̐̅͗t͍̠͇e̓ͥ͑ͨ͌͆ ̪̮͇̻̫ͅ hnabbasi
https://github.com/hnabbasi/BottomNavigationViewPager
 ̮̼̤̯͐̅̆̒
 *̙͓̠̲̼͆ͣ̔̒̂/

*/
using Android.App;
using Android.Content;
using Android.Content.Res;
using Android.Graphics.Drawables;
using Android.OS;
using Android.Support.Design.Internal;
using Android.Support.Design.Widget;
using Android.Support.V4.App;
using Android.Support.V4.View;
using Android.Views;
using BitChute.Adapters;
using BitChute;
using BitChute.Fragments;
using BitChute.Web.Ui;
using BitChute.Services;
using System;
using System.Collections.Generic;
using System.Threading.Tasks;
using static Android.Views.View;
using static BitChute.Fragments.SettingsFrag;
using Android.Util;
using BitChute.App;
using BitChute.Web;

namespace BitChute
{
    [Android.App.IntentFilter(new[] { Intent.ActionView },
              Categories = new[] { Intent.CategoryBrowsable, Intent.CategoryDefault },
              DataScheme = "http",
              DataHost = "bitchute.com",
              DataPathPrefix = "",
              AutoVerify = true)]
    [Android.App.Activity(LaunchMode = Android.Content.PM.LaunchMode.SingleTop, Label = "BitChute", Theme = "@style/AppTheme", MainLauncher = true,
        ConfigurationChanges = Android.Content.PM.ConfigChanges.Orientation | Android.Content.PM.ConfigChanges.ScreenSize,
        ParentActivity = typeof(MainActivity))]
    public class MainActivity : FragmentActivity
    {
        int _tabSelected;

        public static ViewPager ViewPager;
        public static BottomNavigationView NavigationView;
        public static List<BottomNavigationItemView> NavViewItemList
            = new List<BottomNavigationItemView>();

        IMenuItem _menu;
        private static Drawable _tab4Icon;
        private static Drawable _tab5Icon;
        public static Android.Support.V4.App.Fragment[] ViewFragmentArray;

        public static MainActivity Main;
        public static Bundle _bundle;

        public static bool _navBarHideTimeout = false;

        //notification items:
        public static int NOTIFICATION_ID = 1000;
        public static readonly string CHANNEL_ID = "notification";
        public static readonly string BACKGROUND_CHANNEL_ID = "backgroundcontrols";
        public static readonly string COUNT_KEY = "count";

        public static Window _window;
        public static View MainView;

        readonly WindowManagerFlags _winFlagUseHw = WindowManagerFlags.HardwareAccelerated;
        public static DisplayMetrics metrics = new DisplayMetrics();

        public static string NotificationStartedAppWithUrl;

        public static CustomIntent.ControlIntentReceiver ForegroundReceiver;

        protected override void OnCreate(Bundle savedInstanceState)
        {
            Main = this;
            StartUp();
            _window = this.Window;
            base.OnCreate(savedInstanceState);
            _window.AddFlags(_winFlagUseHw);
            SetContentView(Resource.Layout.Main);
            //Android.Webkit.WebView wv = (Android.Webkit.WebView)
            ViewHelpers.Main.ContentRelativeLayout = FindViewById<Android.Widget.RelativeLayout>(Resource.Id.activityMain);
            //wv.SetBackgroundColor(Android.Graphics.Color.Black);
            //wv.LoadUrl("file:///android_asset/html/splash.html");
            WindowManager.DefaultDisplay.GetMetrics(metrics);
            AppState.Display.ScreenHeight = metrics.HeightPixels;
            AppState.Display.ScreenWidth = metrics.WidthPixels;

            if (Resources.Configuration.Orientation == Orientation.Landscape)
            {
                AppState.Display.Horizontal = true;
                _window.ClearFlags(_winflagnotfullscreen);
                _window.AddFlags(_winflagfullscreen);
            }
            else
            {
                AppState.Display.Horizontal = false;
            }
            var mServiceIntent = new Intent(this, typeof(MainPlaybackSticky));
            StartService(mServiceIntent);
            //get the intent incase a notification started the activity
            Intent _sentIntent = Intent;
            if (_sentIntent != null)
            {
                //if it's not null then set the fragment0 url to our intent url string
                try
                {
                    NotificationStartedAppWithUrl = _sentIntent.Extras?.GetString("URL");
                    if (NotificationStartedAppWithUrl != "" && NotificationStartedAppWithUrl != null)
                    {
                        AppState.NotificationStartedApp = true;
                    }
                }
                catch { }
            }
            CreateNotificationChannel();
            ViewHelpers.Main.DownloadFAB = FindViewById<FloatingActionButton>(Resource.Id.downloadFab);
            if (AppSettings.DlFabShowSetting == "never" || AppSettings.DlFabShowSetting == "onpress")
            {
                ViewHelpers.Main.SetDownloadFabViewState(true);
            }
            ForegroundReceiver = new CustomIntent.ControlIntentReceiver();
        }

        public void FinalizeStartUp()
        {
            ViewPager = FindViewById<ViewPager>(Resource.Id.viewpager);
            ViewPager.PageSelected += ViewPager_PageSelected;
            ViewPager.Adapter = new ViewPagerAdapter(SupportFragmentManager, ViewFragmentArray);
            NavigationView = FindViewById<BottomNavigationView>(Resource.Id.bottom_navigation);
            NavigationView = CustomizeBottomNavigationViewMenuItems(NavigationView, TabStates.GetTabFragPackages(true), true);
            NavigationView.NavigationItemSelected += NavigationView_NavigationItemSelected;
            NavigationView.NavigationItemReselected += NavigationView_NavigationItemReSelected;
            ViewPager.OffscreenPageLimit = 4;
        }

        public static BottomNavigationItemView GetBottomNavItemFromView(View view)
        {
            return (BottomNavigationItemView)view;
        }

        BottomNavigationView CustomizeBottomNavigationViewMenuItems(BottomNavigationView bottomNavigationView, List<TabStates.TabFragPackage> tabs = null, bool setExisting = false, bool removeShiftMode = true)
        {
            BottomNavigationMenuView menuView = (BottomNavigationMenuView)bottomNavigationView.GetChildAt(0);
            try {
                //view.ScaleY = (float)1.1;
                var shiftingMode = menuView.Class.GetDeclaredField("mShiftingMode");
                shiftingMode.Accessible = true;
                shiftingMode.SetBoolean(menuView, false);
                shiftingMode.Accessible = false;
            }
            catch {  }
            var positionKey = -1;

            if (!setExisting && tabs != null)
            {
                foreach (var tab in tabs)
                {
                    positionKey++;
                    var item = (BottomNavigationItemView)menuView.GetChildAt(positionKey);
                    item.SetShiftingMode(false);
                    // set once again checked value, so view will be updated
                    item.SetChecked(true);
                    //BottomNavigationItemView tab = new BottomNavigationItemView(GetMainContext());
                    item.SetIcon(tab.Icon);
                    item.SetEnabled(true);
                    item.SetTitle(tab.Title);
                    item.ItemPosition = positionKey;
                    //menuView.AddView(tab, positionKey);
                }
            }
            else if (setExisting && tabs != null)
            {
                for (int i = 0; i < menuView.ChildCount; i++)
                {
                    try {
                        GetBottomNavItemFromView(menuView.GetChildAt(i)).SetShiftingMode(false);
                        GetBottomNavItemFromView(menuView.GetChildAt(i)).ItemData.SetIcon(tabs[i].Icon);
                        GetBottomNavItemFromView(menuView.GetChildAt(i)).ItemData.SetTitle(tabs[i].Title);
                        GetBottomNavItemFromView(menuView.GetChildAt(i)).SetChecked(true);
                        if (i == 0) { GetBottomNavItemFromView(menuView.GetChildAt(i)).LongClick += HomeLongClickListener; }
                        if (i == 2) { GetBottomNavItemFromView(menuView.GetChildAt(i)).LongClick += FeedTabLongClickListener; }
                        if (i == 3) { GetBottomNavItemFromView(menuView.GetChildAt(i)).LongClick += MyChannelLongClickListener; }
                        if (i == 4) { GetBottomNavItemFromView(menuView.GetChildAt(i)).LongClick += SettingsTabLongClickListener; }
                        
                    }
                    catch { }
                    try
                    {
                        NavViewItemList.Add(GetBottomNavItemFromView(menuView.GetChildAt(i)));
                    }
                    catch { }
                }
            }

            return bottomNavigationView;
        }

        void RemoveShiftMode(BottomNavigationView view)
        {
            var menuView = (BottomNavigationMenuView)view.GetChildAt(0);

            try
            {
                //view.ScaleY = (float)1.1;
                var shiftingMode = menuView.Class.GetDeclaredField("mShiftingMode");
                shiftingMode.Accessible = true;
                shiftingMode.SetBoolean(menuView, false);
                shiftingMode.Accessible = false;

                for (int i = 0; i < menuView.ChildCount; i++)
                {
                    var item = (BottomNavigationItemView)menuView.GetChildAt(i);
                    item.SetShiftingMode(false);
                    // set once again checked value, so view will be updated
                    item.SetChecked(true);
                    item.SetShiftingMode(false);
                    if (i == 0) { item.LongClick += HomeLongClickListener; }
                    if (i == 2) { item.LongClick += FeedTabLongClickListener; }
                    if (i == 3) { item.LongClick += MyChannelLongClickListener; }
                    if (i == 4) { item.LongClick += SettingsTabLongClickListener; }
                    if (NavViewItemList != null) { NavViewItemList.Add(item); }
                }
            }
            catch (System.Exception ex)
            {
                System.Console.WriteLine((ex.InnerException ?? ex).Message);
            }
        }

        void NavigationView_NavigationItemSelected(object sender, BottomNavigationView.NavigationItemSelectedEventArgs e)
        {
            ViewPager.SetCurrentItem(e.Item.Order, true);
            NavTimer = 0;
        }

        void NavigationView_NavigationItemReSelected(object sender, BottomNavigationView.NavigationItemReselectedEventArgs e)
        {
            CommonFrag.GetFragmentById(-1, null, e.Item.Order).Pop2Root();
        }

        private void ViewPager_PageSelected(object sender, ViewPager.PageSelectedEventArgs e)
        {
            NavTimer = 0;
            _menu = NavigationView.Menu.GetItem(e.Position);
            NavigationView.SelectedItemId = _menu.ItemId;
            _tabSelected = ViewPager.CurrentItem;
            CustomOnSwipe();
        }

        public static bool SplashScreenIsVisible;

        public static void SwapSplashView()
        {
            if (!SplashScreenIsVisible)
            {
                ViewHelpers.Main.ContentRelativeLayout.AddView(ViewHelpers.Main.SplashLayout);
            }
            else
            {
                ViewHelpers.Main.ContentRelativeLayout.RemoveView(ViewHelpers.Main.SplashLayout);
            }
            SplashScreenIsVisible = !SplashScreenIsVisible;
        }


        public static async void StartUp()
        {
            //Web.ExtWebInterface.CookieHeader = Android.Webkit.CookieManager.Instance.GetCookie("https://www.bitchute.com/");
            await AppSettings.LoadAllPrefsFromSettings();
            await BitChute.Web.Startup.GetObjectsFromHtmlResponse();
            InitializeFragments();
        }

        public static void InitializeFragments()
        {
            Fm0 = HomePageFrag.NewInstance("Home", "tab_home", null, 0);
            Fm1 = SubscriptionFrag.NewInstance("Subs", "tab_subs", null, 1);
            Fm2 = FeedFrag.NewInstance("Subs", "tab_home", null, 2);
            Fm3 = MyChannelFrag.NewInstance("MyChannel", "tab_home", AppSettings.Tab3OverridePreference, 3); 
            Fm4 = SettingsFrag.NewInstance("Settings", "tab_home", AppSettings.Tab4OverridePreference, 4);
            Main.InitializeTabs();
            Main.FinalizeStartUp();
        }

        public static HomePageFrag Fm0;
        public static SubscriptionFrag Fm1;
        public static FeedFrag Fm2;
        public static MyChannelFrag Fm3;
        public static SettingsFrag Fm4;

        void InitializeTabs() { ViewFragmentArray = new Android.Support.V4.App.Fragment[] { Fm0, Fm1, Fm2, Fm3, Fm4 }; }

        // public static bool NavHidden = false;
        public static bool NavTimeout = true;
        public static int NavTimer = 0;

        public async void CustomOnSwipe()
        {
            if (NavTimer != 0)
                NavTimer = 0;

            if (!NavTimeout || AppState.Display.Horizontal)
            {
                NavigationView.Visibility = ViewStates.Visible;
                ViewHelpers.Main.NavHidden = false;
                NavBarRemove();
                NavTimeout = true;
            }
        }

        /// <summary>
        /// invoked on swipe events and hides the navbar after x seconds
        /// .. timer resets every time it's called
        /// . works with a custom scroll listener
        /// </summary>
        public static async void CustomOnTouch()
        {
            await Task.Delay(1);

            if (NavTimer != 0)
                NavTimer = 0;

            if (AppState.Display.Horizontal && !AppSettings.HideHorizontalNavBar)
            {
                if (!NavTimeout)
                {
                    NavigationView.Visibility = ViewStates.Visible;
                    ViewHelpers.Main.NavHidden = false;
                    NavBarRemove();
                    NavTimeout = true;
                }
            }
            else if (!AppState.Display.Horizontal)
            {
                if (NavigationView.Visibility == ViewStates.Gone)
                {
                    NavigationView.Visibility = ViewStates.Visible;
                    ViewHelpers.Main.NavHidden = false;
                    NavBarRemove();
                    NavTimeout = true;
                }
            }
        }

        public static async void NavBarRemove()
        {
            while (!ViewHelpers.Main.NavHidden)
            {
                await Task.Delay(1000);
                NavTimer++;
                if (NavTimer >= AppSettings.NavRemovalDelay)
                {
                    if (AppState.Display.Horizontal)
                    {
                        NavigationView.Visibility = ViewStates.Gone;
                    }
                    else
                    {
                        if (AppSettings.HideVerticalNavBar)
                        {
                            NavigationView.Visibility = ViewStates.Gone;
                        }
                    }
                    NavTimeout = false;
                    ViewHelpers.Main.NavHidden = true;
                }
            }
        }

        public override bool OnKeyDown(Android.Views.Keycode keyCode, KeyEvent e)
        {
            if (e.KeyCode == Android.Views.Keycode.Back)
            {
                CommonFrag.GetFragmentById(-1, null, ViewPager.CurrentItem).WebViewGoBack();
            }
            return false;
        }


        /// <summary>
        /// forwards the settings to fragments
        /// </summary>
        /// <param name="oa"></param>
        public void OnSettingsChanged(List<object> oa)
        {
            if (AppSettings.Tab3OverrideEnabled){}
            Fm0.OnSettingsChanged(oa);
            Fm1.OnSettingsChanged(oa);
            Fm2.OnSettingsChanged(oa);
            Fm3.OnSettingsChanged(oa);
            Fm4.OnSettingsChanged(oa);
        }

        /// <summary>
        /// changes tabs 4 and 5
        /// int use 3 for MyChannel tab and 4 for Settings tab
        /// string use strings like "Home" "Subs" "Feed" "MyChannel" "Settings" "WatchLater" "Playlists"
        /// </summary>
        /// <param name="tab"></param>
        /// <param name="changeDetails"></param>
        public static void TabDetailChanger(int tab, string changeDetails) // this needs to get changed into a fragment swapper, not use SetTitle
        {
            ((CommonFrag)ViewFragmentArray[tab]).RootUrl = Https.URLs.GetUrlStringFromPref(changeDetails);
            switch (tab)
            {
                case 0:
                    break;
                case 1:
                    break;
                case 2:
                    break;
                case 3:

                    if (changeDetails == "" || changeDetails == null)
                    {
                        NavViewItemList[tab].ItemData.SetTitle("MyChannel");
                        NavViewItemList[tab].ItemData.SetIcon(Main.GetDrawable(Resource.Drawable.tab_mychannel));

                        Fm3.RootUrl = Https.URLs._myChannel;
                    }
                    if (changeDetails == "Home")
                    {
                        NavViewItemList[tab].ItemData.SetTitle("Home");
                        NavViewItemList[tab].ItemData.SetIcon(Main.GetDrawable(Resource.Drawable.tab_home));

                        Fm3.RootUrl = Https.URLs._homepage;
                    }
                    if (changeDetails == "Subs")
                    {
                        NavViewItemList[tab].ItemData.SetTitle("Subs");
                        NavViewItemList[tab].ItemData.SetIcon(Main.GetDrawable(Resource.Drawable.tab_subs));

                        Fm3.RootUrl = Https.URLs._subspage;
                    }
                    if (changeDetails == "Feed")
                    {
                        NavViewItemList[tab].ItemData.SetTitle("Feed");
                        NavViewItemList[tab].ItemData.SetIcon(Main.GetDrawable(Resource.Drawable.tab_playlists));

                        Fm3.RootUrl = Https.URLs._homepage;
                    }
                    if (changeDetails == "MyChannel")
                    {
                        NavViewItemList[tab].ItemData.SetTitle("MyChannel");
                        NavViewItemList[tab].ItemData.SetIcon(Main.GetDrawable(Resource.Drawable.tab_mychannel));

                        Fm3.RootUrl = Https.URLs._myChannel;
                    }
                    if (changeDetails == "Explore")
                    {
                        NavViewItemList[tab].ItemData.SetTitle("Explore");
                        NavViewItemList[tab].ItemData.SetIcon(Main.GetDrawable(Resource.Drawable.tab_subs));

                        Fm3.RootUrl = Https.URLs._explore;
                    }
                    if (changeDetails == "Settings")
                    {
                        NavViewItemList[tab].ItemData.SetTitle("Settings");
                        NavViewItemList[tab].ItemData.SetIcon(Main.GetDrawable(Resource.Drawable.tab_settings));

                        Fm3.RootUrl = Https.URLs._settings;
                    }
                    if (changeDetails == "WatchLater")
                    {
                        NavViewItemList[tab].ItemData.SetTitle("WatchLater");
                        NavViewItemList[tab].ItemData.SetIcon(Main.GetDrawable(Resource.Drawable.tab_mychannel));

                        Fm3.RootUrl = Https.URLs._watchLater;
                    }
                    if (changeDetails == "Downloader")
                    {
                        NavViewItemList[tab].ItemData.SetTitle("Downloader");
                        NavViewItemList[tab].ItemData.SetIcon(Main.GetDrawable(Resource.Drawable.tab_mychannel));
                    }
                    BitChute.Web.ViewClients.SetWebViewClientFromObject(Fm3.Wv,
                        TabStates.GetWebViewClientByType(TabStates.TabFragPackage.FragmentType.None, changeDetails));
                    Fm3.LoadUrlWithDelay(Fm3.RootUrl, 0);
                    break;
                case 4:

                    if (changeDetails == "" || changeDetails == null)
                    {
                        NavViewItemList[tab].ItemData.SetTitle("Settings");
                        NavViewItemList[tab].ItemData.SetIcon(Main.GetDrawable(Resource.Drawable.tab_settings));
                        Fm4.RootUrl = Https.URLs._settings;
                    }
                    if (changeDetails == "Home")
                    {
                        NavViewItemList[tab].ItemData.SetTitle("Home");
                        NavViewItemList[tab].ItemData.SetIcon(Main.GetDrawable(Resource.Drawable.tab_home));
                        Fm4.RootUrl = Https.URLs._homepage;
                    }
                    if (changeDetails == "Subs")
                    {
                        NavViewItemList[tab].ItemData.SetTitle("Subs");
                        NavViewItemList[tab].ItemData.SetIcon(Main.GetDrawable(Resource.Drawable.tab_subs));
                        Fm4.RootUrl = Https.URLs._subspage;
                    }
                    if (changeDetails == "Feed")
                    {
                        NavViewItemList[tab].ItemData.SetTitle("Feed");
                        NavViewItemList[tab].ItemData.SetIcon(Main.GetDrawable(Resource.Drawable.tab_playlists));
                        Fm4.RootUrl = Https.URLs._homepage;
                    }
                    if (changeDetails == "Explore")
                    {
                        NavViewItemList[tab].ItemData.SetTitle("Explore");
                        NavViewItemList[tab].ItemData.SetIcon(Main.GetDrawable(Resource.Drawable.tab_subs));
                        Fm4.RootUrl = Https.URLs._explore;
                    }
                    if (changeDetails == "Settings")
                    {
                        NavViewItemList[tab].ItemData.SetTitle("Settings");
                        NavViewItemList[tab].ItemData.SetIcon(Main.GetDrawable(Resource.Drawable.tab_settings));
                        Fm4.RootUrl = Https.URLs._settings;
                    }
                    if (changeDetails == "WatchLater")
                    {
                        NavViewItemList[tab].ItemData.SetTitle("WatchLater");
                        NavViewItemList[tab].ItemData.SetIcon(Main.GetDrawable(Resource.Drawable.tab_mychannel));
                        Fm4.RootUrl = Https.URLs._watchLater;
                    }
                    Fm4.LoadUrlWithDelay(Fm4.RootUrl, 0);
                    BitChute.Web.ViewClients.SetWebViewClientFromObject(Fm4.Wv,
                        TabStates.GetWebViewClientByType(TabStates.TabFragPackage.FragmentType.None, changeDetails));
                    break;
            }
        }

        public void HomeLongClickListener(object sender, LongClickEventArgs e)
        {
            Fm0.SwapFragView();
        }

        public void MyChannelLongClickListener(object sender, LongClickEventArgs e)
        {
            SwapMyChannelVideoDownloader();
        }

        public void SwapMyChannelVideoDownloader()
        {
            MyChannelFrag.SwapDownloaderView();

        }

        /// <summary>
        /// Listens for long click events on tab 4
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        public void SettingsTabLongClickListener(object sender, LongClickEventArgs e)
        {
            if (ViewPager.CurrentItem != 4)
            {
                ViewPager.CurrentItem = 4;
            }
            Fm4.SwapSettingView();
        }

        /// <summary>
        /// Listens for long click events on tab 2
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        public void FeedTabLongClickListener(object sender, LongClickEventArgs e)
        {
            ForceAppIntoStickyBackground();
            //Fm2.GetSubscriptionFeed();
        }

        public static bool UserRequestedStickyBackground = false;

        /// <summary>
        /// Requests the app start sticky background playback service
        /// and move into background, regardless of playstate 
        /// </summary>
        public static void ForceAppIntoStickyBackground()
        {
            UserRequestedStickyBackground = true;
            MainPlaybackSticky.StartForeground(BitChute.ExtNotifications.BuildPlayControlNotification(), true, true);
            Main.MoveTaskToBack(true);
        }

        public Android.App.ActivityManager GetCustomActivityManager()
        {
            Android.App.ActivityManager _am = (Android.App.ActivityManager)Android.App.Application
                    .Context.GetSystemService(Context.ActivityService);
            return _am;
        }

        public static int ServiceTimer = 0;
        public static int BackgroundTimeoutInt = 0;
        public static int BackgroundLoopMsDelayInt = 3600;

        void CreateNotificationChannel()
        {
            var alarmAttributes = new Android.Media.AudioAttributes.Builder()
                .SetContentType(Android.Media.AudioContentType.Unknown)
                    .SetUsage(Android.Media.AudioUsageKind.NotificationRingtone).Build();

            if (Build.VERSION.SdkInt < BuildVersionCodes.O) { return; }

            var name = "BitChute";
            var description = "BitChute for Android";
            var nameBackgroundPlayback = "BitChute Background Streaming";
            var channelSilent = new Android.App.NotificationChannel(CHANNEL_ID, name + " Silent", Android.App.NotificationImportance.High)
            {
                Description = description
            };

            var channel = new Android.App.NotificationChannel(CHANNEL_ID + 1, name, Android.App.NotificationImportance.High)
            {
                Description = description
            };

            var backChannel = new Android.App.NotificationChannel(BACKGROUND_CHANNEL_ID, nameBackgroundPlayback, Android.App.NotificationImportance.Max)
            {
                Description = description,
                Importance = NotificationImportance.Max,
                LockscreenVisibility = NotificationVisibility.Public
            };

            channel.LockscreenVisibility = NotificationVisibility.Public;
            var notificationManager = (Android.App.NotificationManager)GetSystemService(NotificationService);
            channelSilent.SetSound(null, null);
            backChannel.SetSound(null, null);
            notificationManager.CreateNotificationChannel(channel);
            notificationManager.CreateNotificationChannel(channelSilent);
            notificationManager.CreateNotificationChannel(backChannel);
        }

        private Action<int, Result, Intent> resultCallbackvalue;

        public void StartActivity(Intent intent, int requestCode, Action<int, Result, Intent> resultCallback)
        {
            //if (intent.Action == Intent.ActionGetContent)
            //{
            this.resultCallbackvalue = resultCallback;
            StartActivityForResult(intent, requestCode);
            //}
        }

        public override void StartActivityForResult(Intent intent, int requestCode)
        {
            _chooserIntentStr = intent.GetStringExtra("sendTo");
            base.StartActivityForResult(intent, requestCode);
        }

        private static string _chooserIntentStr;

        protected override void OnActivityResult(int requestCode, Result resultCode, Intent data)
        {
            if (resultCode == Result.Canceled) { return; }
            else if (resultCode == Result.Ok)
            {
                try
                {
                    if (data.Data != null)
                    {
                        //var path = FileBrowser.ImportFileToString(data.Data, _chooserIntentStr, this.ApplicationContext); // for importing strings, not used ATM as URI is more universal
                        var path = FileBrowser.ImportFileToUri(data.Data, _chooserIntentStr, this.ApplicationContext);

                    }
                }
                catch { }
                base.OnActivityResult(requestCode, resultCode, data);
                if (this.resultCallbackvalue != null)
                {
                    this.resultCallbackvalue(requestCode, resultCode, data);
                    this.resultCallbackvalue = null;
                }
                _chooserIntentStr = null;
            }
        }

        public static bool NotificationRequestedInBackground = false;
        public static bool NotificationIsBringingAppForeground = false;

        protected override void OnNewIntent(Intent intent)
        {
            string url = "";
            if (intent != null)
            {
                try
                {
                    url = intent.GetStringExtra("URL");
                    if ((url != null || url != "") && MainPlaybackSticky.NotificationShouldPlayInBkgrd)
                    {
                        NotificationIsBringingAppForeground = true;
                        NotificationRequestedInBackground = true;
                        Main.MoveTaskToBack(true);
                    }
                }
                catch { }
            }
            if (url == "" || url == null) { return; }
            try
            {
                if (PlaystateManagement.PlayerTypeQueued() == PlaystateManagement.PlayerType.WebViewPlayer)
                {
                    if (!AppState.NotificationStartedApp)
                    {
                        if (PlaystateManagement.GetWebViewPlayerById(-1, ViewPager.CurrentItem).Id
                            != PlaystateManagement.WebViewPlayerNumberIsStreaming)
                        {
                            PlaystateManagement._webViewPlayerQueuedId = PlaystateManagement.WebViewPlayerNumberIsStreaming;
                        }
                        PlaystateManagement.GetWebViewPlayerById(-1, ViewPager.CurrentItem).LoadUrlWithDelay(url);
                        PlaystateManagement.WebViewPlayerNumberIsStreaming =
                            PlaystateManagement.GetWebViewPlayerById(-1, ViewPager.CurrentItem).Id;
                        PlaystateManagement.WebViewPlayerIsStreaming = true;
                    }
                }
                else { }
            }
            catch { }
            base.OnNewIntent(intent);
        }

        readonly WindowManagerFlags _winflagfullscreen = WindowManagerFlags.Fullscreen;
        readonly WindowManagerFlags _winflagnotfullscreen = WindowManagerFlags.ForceNotFullscreen;

        public override void OnConfigurationChanged(Configuration newConfig)
        {
            base.OnConfigurationChanged(newConfig);
            if (newConfig.Orientation == Orientation.Landscape)
            {
                NavigationView.Visibility = ViewStates.Gone;
                try {
                    if (CommonFrag.GetFragmentById(-1, null, ViewPager.CurrentItem).Wv.Url.StartsWith(@"https://www.bitchute.com/video/") &&
                         CommonFrag.GetFragmentById(-1, null, ViewPager.CurrentItem).Wv.RootUrl != Https.URLs._settings &&
                         CommonFrag.GetFragmentById(-1, null, ViewPager.CurrentItem).Wv.RootUrl != Https.URLs._myChannel)
                    {
                        CommonFrag.GetFragmentById(-1, null, ViewPager.CurrentItem)
                          .Wv.LoadUrl(JavascriptCommands.GetInjectable(JavascriptCommands.JsHideTitle +
                          JavascriptCommands.JsHideWatchTab + JavascriptCommands.JsHideTooltips + JavascriptCommands.JsHidePageBar));
                    }
                    else if (CommonFrag.GetFragmentById(-1, null, ViewPager.CurrentItem).Wv.Url.StartsWith(@"https://www.bitchute.com/channel/") ||
                        CommonFrag.GetFragmentById(-1, null, ViewPager.CurrentItem).Wv.RootUrl == Https.URLs._myChannel ||
                        CommonFrag.GetFragmentById(-1, null, ViewPager.CurrentItem).Wv.RootUrl == Https.URLs._settings ||
                        CommonFrag.GetFragmentById(-1, null, ViewPager.CurrentItem).Wv.Url == Https.URLs._homepage)
                    {
                        CommonFrag.GetFragmentById(-1, null, ViewPager.CurrentItem)
                               .Wv.LoadUrl(JavascriptCommands.GetInjectable(
                               JavascriptCommands.JsHideTitle + JavascriptCommands.JsHideTooltips));
                    }
                    else
                    {
                        CommonFrag.GetFragmentById(-1, null, ViewPager.CurrentItem)
                            .Wv.LoadUrl(JavascriptCommands.GetInjectable(
                                JavascriptCommands.JsShowTitle + JavascriptCommands.JsHideTooltips + JavascriptCommands.JsHidePageBar));
                    }
                    AppState.Display.Horizontal = true;
                    _window.ClearFlags(_winflagnotfullscreen);
                    _window.AddFlags(_winflagfullscreen);
                } catch { }
            }
            else if (newConfig.Orientation == Orientation.Portrait)
            {
                if (CommonFrag.GetFragmentById(-1, null, ViewPager.CurrentItem).Wv.Url.Contains(@"https://www.bitchute.com/video/") &&
                     CommonFrag.GetFragmentById(-1, null, ViewPager.CurrentItem).Wv.RootUrl != Https.URLs._settings &&
                     CommonFrag.GetFragmentById(-1, null, ViewPager.CurrentItem).Wv.RootUrl != Https.URLs._myChannel)
                {
                    CommonFrag.GetFragmentById(-1, null, ViewPager.CurrentItem)
                      .Wv.LoadUrl(JavascriptCommands.GetInjectable(JavascriptCommands.JsShowTitle + JavascriptCommands.JsHideTooltips));
                }
                else if (CommonFrag.GetFragmentById(-1, null, ViewPager.CurrentItem).Wv.Url.StartsWith(@"https://www.bitchute.com/channel/") ||
                    CommonFrag.GetFragmentById(-1, null, ViewPager.CurrentItem).Wv.Url.StartsWith(@"https://www.bitchute.com/profile/") ||
                    CommonFrag.GetFragmentById(-1, null, ViewPager.CurrentItem).Wv.RootUrl == Https.URLs._myChannel ||
                    CommonFrag.GetFragmentById(-1, null, ViewPager.CurrentItem).Wv.RootUrl == Https.URLs._settings ||
                    CommonFrag.GetFragmentById(-1, null, ViewPager.CurrentItem).Wv.Url == Https.URLs._homepage)
                {
                    CommonFrag.GetFragmentById(-1, null, ViewPager.CurrentItem)
                           .Wv.LoadUrl(JavascriptCommands.GetInjectable(
                           JavascriptCommands.JsShowTitle + JavascriptCommands.JsShowWatchTab + JavascriptCommands.JsHideTooltips));
                }
                else
                {
                    CommonFrag.GetFragmentById(-1, null, ViewPager.CurrentItem)
                        .Wv.LoadUrl(JavascriptCommands.GetInjectable(
                            JavascriptCommands.JsShowTitle + JavascriptCommands.JsHideTooltips));
                }
                AppState.Display.Horizontal = false;
                _window.ClearFlags(_winflagfullscreen);
                _window.AddFlags(_winflagnotfullscreen);
                CustomOnTouch();
            }
            if (!AppSettings.HideHorizontalNavBar || newConfig.Orientation == Orientation.Portrait)
            {
                NavTimeout = false;
            }
        }

        //OnPause called first = app actually put in background
        //OnWindowFocusChanged then OnPause is probably from a notification click or volume change event

        static bool WindowFocusChangedToBackground = false;
        static bool ActivityPaused = false;

        enum AppMinimizeOrder
        {
            None,
            WindowFocusChangedFirst,
            AppPausedFirst,
            BackgroundExplicit
        };

        public override void OnWindowFocusChanged(bool hasFocus)
        {
            WindowFocusChangedToBackground = hasFocus; // track if window focus changed to check if this fired before or after OnPause()
        }

        void OnDelayedWindowFocusChange(bool hasFocus)
        {
            base.OnWindowFocusChanged(hasFocus);
        }

        protected override void OnPause()
        {
            VerifyInBackground(WindowFocusChangedToBackground);

            if (UserRequestedStickyBackground)
            {
                StartStickyAfterDelay(0, UserRequestedStickyBackground, CommonFrag.GetFragmentById(-1, null, ViewPager.CurrentItem).Wv.Id);

                UserRequestedStickyBackground = false;
            }

            base.OnPause();
        }

        public async void DelayedPause()
        {
        }

        public static void VerifyInBackground(bool windowFocusChangedBeforeOnPause)
        {

            MainPlaybackSticky.ServiceWebView.ClearWebViewMinimizedState();
            foreach (var webView in PlaystateManagement.WebViewIdDictionary)
            {
                webView.Value.LoadUrl(JavascriptCommands.GetInjectable(JavascriptCommands.CallBackInjection.IsPlayingCallbackSimpleWithBuffer));
                MainPlaybackSticky.ServiceWebView.TotalWebViewsMovingIntoBackground++;
            }
        }

        protected override void OnResume()
        {
            MainPlaybackSticky.AppIsMovingIntoBackgroundAndStreaming = false;
            base.OnResume();
        }
        
        public static Tuple<int, MainPlaybackSticky.ServiceWebView> LatestDetectedPlayingWebView;
        private static List<MainPlaybackSticky.ServiceWebView> _latestDetectedPlayingWebView = new List<MainPlaybackSticky.ServiceWebView>();
        public static async void AwaitGetCurrentlyPlayingWebView()
        {
            _latestDetectedPlayingWebView = await ExtWebValueCallbackListener.GetCurrentlyPlayingWebView();
        }

        public static async void StartStickyAfterDelay(int d = 3000, bool userRequestedStickyBackground = false, int idOverride = -1)
        {
            if (idOverride != -1) { }
            else {
                idOverride = CommonFrag.GetFragmentById(-1, null, ViewPager.CurrentItem).Wv.Id;
            }
            if (userRequestedStickyBackground)
            {
                MainPlaybackSticky.StartVideoInBkgrd(idOverride);
                CommonFrag.GetFragmentById(-1, null, ViewPager.CurrentItem).Wv.StickyBackgroundRequested = true;
            }
            await Task.Delay(d);
            if (MainPlaybackSticky.IsInBkGrd() && PlaystateManagement.WebViewPlayerIsStreaming && AppSettings.AutoPlayOnMinimized != "off")
            {
                if (AppState.ForeNote == null)
                MainPlaybackSticky.StartForeground(BitChute.ExtNotifications.BuildPlayControlNotification(), true, true);
            }
        }
        
        protected override void OnDestroy()
        {
            if (AppState.UserIsLoggedIn)
            {
                AppSettings.UserWasLoggedInLastAppClose = true;
            }
            else
            {
                AppSettings.UserWasLoggedInLastAppClose = false;
            }
            try
            {
                //UnregisterReceiver(ForegroundReceiver); //@TODO check what this does
                //
                AppState.NotificationStartedApp = false;
                MainPlaybackSticky.NotificationShouldPlayInBkgrd = false; // set this to false if user closes the app so that future notification clicks will restart the app
            }
            catch { }
            ViewPager.PageSelected -= ViewPager_PageSelected;
            NavigationView.NavigationItemSelected -= NavigationView_NavigationItemSelected;
            try { MainPlaybackSticky.ExternalStopForeground();
                AppState.ForeNote = null;

            }
            catch(Exception ex) { }
            try
            {
                foreach (var wv in PlaystateManagement.WebViewIdDictionary)
                {
                    wv.Value.LoadUrl(JavascriptCommands._jsPauseVideo);
                }
            }
            catch { }
            MainPlaybackSticky.AppIsMovingIntoBackgroundAndStreaming = false;
            base.OnDestroy();
        }

        public static Context GetMainContext() { return Main.ApplicationContext; }
    }
}